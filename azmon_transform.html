<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>AzMon Transform Validation WASM Example</title>

  <script type="module">
    import init, { validate } from './pkg/azmon_transform_wasm.js';

    await init();
    console.log("azmon_transform_wasm initialized");

    window.click_validate = () => {
      let dcr = document.getElementById("dcr_text").value;
      let resp = validate(dcr);
      let pretty = JSON.stringify(JSON.parse(resp), null, 2);
      document.getElementById("results").textContent = pretty;
    }
  </script>
</head>

<body>
  <script>
    function example(num) {
      let json = "{}";
      switch (num) {
        case 1:
          json = `
{
  "properties": {
    "transformations": [
      {
        "name": "Example 1",
        "headerProcessor": {
          "processor": "header.WindowsPerformanceCounters"
        },
        "processors": []
      }
    ]
  }
}
          `;
          json = JSON.stringify(JSON.parse(json), null, 2);
          break;

        case 2:
          json = `
{
  "properties": {
    "transformations": [
      {
        "name": "Example 1",
        "headerProcessor": {
          "processor": "header.WindowsPerformanceCounters"
        },
        "processors": [
          {
            "processor": "map.Drop",
            "configuration": {
              "columnNames": [
                "Counter"
              ]
            }
          },
          {
            "processor": "map.Rename",
            "configuration": {
              "all": [
                {
                  "columnName": "CounterValue",
                  "nameAs": "Value",
                  "typeAs": "int"
                }
              ]
            }
          },
          {
            "processor": "filter.Basic",
            "configuration": {
              "any": [
                {
                  "all": [
                    {
                      "columnName": "CounterName",
                      "operator": "contains",
                      "value": "name_of_counter1"
                    }
                  ]
                },
                {
                  "all": [
                    {
                      "columnName": "Value",
                      "operator": ">",
                      "value": "10"
                    }
                  ]
                }
              ]
            }
          },
          {
            "processor": "aggregate.Basic",
            "configuration": {
              "aggregates": [
                {
                  "columnName": "Value",
                  "operator": "sum",
                  "nameAs": "sum_of_value"
                }
              ],
              "dimensionColumns": [
                "CounterName",
                "Instance"
              ]
            }
          }
        ]
      }
    ]
  }
}
          `;
          json = JSON.stringify(JSON.parse(json), null, 2);
          break;

        case 3:
          json = `
{
    "properties": {
        "transformations": [
            {
                "name": "Test",
                "headerProcessor": {
                    "processor": "header.SysLog"
                },
                "processors": [
                    {
                        "processor": "parse.CEFAttribute",
                        "configuration": {
                            "columnName": "Message",
                            "all": [
                                {
                                  "columnName": "duser",
                                  "nameAs": "CEF_duser"
                                },
                                {
                                  "columnName": "Host"
                                }
                            ]
                        }
                    },
                    {
                        "processor": "parse.JsonPath",
                        "configuration": {
                            "columnName": "Message",
                            "all": [
                                {
                                    "columnName": "Message",
                                    "nameAs": "Message_JSON"
                                }
                            ]
                        }
                    }
                ]
            }
        ]
    }
}
`;
          json = JSON.stringify(JSON.parse(json), null, 2);
          break;

        case 4:
          json = `
{
    "properties": {
        "streamDeclarations": {
            "Custom-MyLogFileFormat": {
                "columns": [
                    {
                        "name": "TimeGenerated",
                        "type": "datetime"
                    },
                    {
                        "name": "FilePath",
                        "type": "string"
                    },
                    {
                        "name": "Code",
                        "type": "int"
                    },
                    {
                        "name": "Module",
                        "type": "string"
                    },
                    {
                        "name": "Message",
                        "type": "string"
                    }
                ]
            }
        },
        "transformations": [
            {
                "name": "Test",
                "headerProcessor": {
                    "processor": "header.CustomStream",
                    "configuration": {
                        "streamId": "Custom-MyLogFileFormat"
                    }
                },
                "processors": [
                ]
            }
        ]
    }
}
`;
          json = JSON.stringify(JSON.parse(json), null, 2);
          break;

        case 5:
          json = '{ "Hello" }';
          break;
      }

      let dcr_text = document.getElementById("dcr_text");
      dcr_text.value = json;
    }
  </script>

  <h1>AzMon Transform Validation</h1>
  <div style="display: flex;">
    <span style="width: 50%">
      Input DCR: (examples:
      <a href="#" onclick="example(1);">1</a>
      <a href="#" onclick="example(2);">2</a>
      <a href="#" onclick="example(3);">3</a>
      <a href="#" onclick="example(4);">4</a>
      <a href="#" onclick="example(5);">5</a>
      )
      <br />
      <textarea id="dcr_text" style="width: 99%" rows="50"></textarea>
    </span>
    <span style="width: 50%">
      Output:<br />
      <textarea id="results" style="width: 99%; background-color: lightgray;" rows="50" readonly></textarea>
    </span>
  </div>
  <div style="padding: 2px;">
    <button onclick="click_validate();">Validate</button>
  </div>
</body>

</html>